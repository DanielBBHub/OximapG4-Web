<!DOCTYPE html>
<html>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PERFIL</title>

    <link rel="stylesheet" type="text/css" href="src/app/css/perfil.css">
    <link rel="stylesheet" type="text/css" href="src/app/css/menu.css">

    <!-- CSS only
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    JavaScript Bundle with Popper
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
     Importando la logica fake en html para darle funcionalidad a los botones
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" /> -->

</head>


<body>

<div id="top"></div>

<!--------------------------------- ENCABEZADO ------------------------------------->
<header>
    <section class="wrapper">
        <nav>
            <li><a href="./usuario.html"><img src="./src/app/img/logo_con_nombre.png" class="logo"></a></li>
            <li><a id="cerrar_sesion" href="./index.html"><img src="./src/app/img/cerrar-sesionblanco.png" class="loginuser"></a></li>
        </nav>
    </section>

</header>
<!---------------------------------------------------------------------------------->

<!------------------------------------PERFIL --------------------------------------->
<div class="decoracion">
<div class="contenedorUsuario">
        <h2 class="titulo">PERFIL</h2>
        <br>
        <div class="flex">
            <div class="border">
                <img id="imgUsuario" class="imgUsuario" src="src/app/img/usuario.png" >
                <br>
                <br>
                <h4 class="camposPerfil">Nombre completo:</h4>
                <h4 id="nombreUsuarioTxt" class="texto"></h4>
            </div>


            <br>
            <div class="border">
                <h4 class="camposPerfil">Correo electónico:</h4>
                <h4 id="correoUsuarioTxt" class="texto"></h4>
                <br>

                <h4 class="camposPerfil">Fecha de registro:</h4>
                <h4 id="fechaUsuarioTxt" class="texto"></h4>
                <br>
                <br>
                <a id="boton_editar_perfil"  href="editar_perfil.html"><button class="btn">EDITAR PERFIL</button></a>
            </div>
        </div>
    </div>
</div>

        <!---------------------------------------------------------------------------------->

        <!--------------------------------- FOOTER ----------------------------------------->
        <footer id="foter">
            <div class="contenedorFooter">
                <span class="copyright">OXIMAP © 2022</span>
            </div>

        </footer>
        <!---------------------------------------------------------------------------------->


<script type="module">
    // Import the functions you need from the SDKs you need
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
    import {getAuth, onAuthStateChanged, signOut} from "https://www.gstatic.com/firebasejs/9.13.0/firebase-auth.js";
    import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-storage.js";
    import firebaseutil from "./js/firebase_util.js"
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyBBGGWQJI519Xm8VM8Ocn0P9RSxdSK-s5I",
        authDomain: "oximapg4-login.firebaseapp.com",
        projectId: "oximapg4-login",
        storageBucket: "oximapg4-login.appspot.com",
        messagingSenderId: "905799197481",
        appId: "1:905799197481:web:e136730907ae07b3b90d38",
        measurementId: "G-KCP6LXPCH5",
        storageBucket:"gs://oximapg4-login.appspot.com"
    };


    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // Initialize Firebase Authentication and get a reference to the service
    const auth = getAuth(app);
    
    // Initialize Cloud Storage and get a reference to the service
    const storage = getStorage(app);

    document.onreadystatechange = function () {
        const auth = getAuth();
        const user = auth.currentUser;
        let util = new firebaseutil()
        if(document.readyState == "complete")
        {
            
            document.getElementById("cerrar_sesion").addEventListener("click", function(){
                signOut(auth).then(() => {
                // Sign-out successful.
                window.location.replace("./index.html");
                }).catch((error) => {
                // An error happened.
                });
            })

            document.getElementById("boton_editar_perfil").addEventListener("click", function () {
                window.location.replace("./editar_perfil.html");

            })

            onAuthStateChanged(auth, async (user) => {
                    if(user)
                {
                    // Create a root reference
                    const storage = getStorage();
                    // Create a reference to 'Imagenes/'
                    const imagesRef = ref(storage, 'Imagenes/' + user.uid);                
                
                    await util.mostrar_imagen_usuario(imagesRef)
                    await util.mostrar_info_usuario(user) 
                
                }
            });
    }
    }
</script>
</body>


</html>